<!DOCTYPE html> <html lang="zh-CN"> <head> <meta charset="UTF-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <title>Quickerch - 测试版</title> <style> * { margin: 0; padding: 0; box-sizing: border-box; } body { min-height: 100vh; display: flex; flex-direction: column; justify-content: center; align-items: center; font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif; padding: 20px; background-size: cover; background-position: center; background-repeat: no-repeat; transition: background 0.8s cubic-bezier(0.34, 1.56, 0.64, 1); position: relative; } .time-mode { background: linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.7)), url('/src/qubeta.jpg'); } .search-mode { background: linear-gradient(135deg, #1a2980, #26d0ce); } .container { text-align: center; max-width: 480px; width: 100%; z-index: 10; } .main-title { font-size: 40px; color: white; margin-bottom: 8px; font-weight: 800; cursor: pointer; text-shadow: 0 2px 6px rgba(0,0,0,0.3); transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1); transform-origin: center; display: flex; align-items: center; justify-content: center; gap: 8px; } .main-title.pressed { transform: translateY(-10px) scale(0.95); } .main-title.released { animation: bounceBack 0.6s cubic-bezier(0.34, 1.56, 0.64, 1); } @keyframes bounceBack { 0% { transform: translateY(-10px) scale(0.95); } 50% { transform: translateY(5px) scale(1.02); } 100% { transform: translateY(0) scale(1); } } .quick-part { background: linear-gradient(90deg, #1a2980, #26d0ce); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; color: transparent; } .erch-part { color: white; } .beta-badge { background: #ffcc00; color: #000; font-size: 16px; font-weight: bold; padding: 2px 8px; border-radius: 12px; } .sub-title { font-size: 18px; color: rgba(255, 255, 255, 0.8); margin-bottom: 25px; font-weight: 500; } #time-display { font-size: 26px; color: white; margin-bottom: 25px; font-weight: 600; text-shadow: 0 2px 6px rgba(0,0,0,0.3); } .search-box { background: rgba(255, 255, 255, 0.25); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); border-radius: 20px; padding: 18px; box-shadow: 0 6px 24px rgba(0, 0, 0, 0.2); border: 1px solid rgba(255, 255, 255, 0.18); opacity: 0; transform: translateY(20px); transition: all 0.6s ease; } .search-box.visible { opacity: 1; transform: translateY(0); } .search-form { display: flex; gap: 10px; margin-bottom: 14px; } #search-input { flex: 1; padding: 10px 14px; font-size: 14px; border: none; border-radius: 18px; outline: none; background: rgba(255, 255, 255, 0.9); color: #333; font-weight: 500; } #search-btn { padding: 10px 20px; font-size: 14px; background: #3498db; color: white; border: none; border-radius: 18px; cursor: pointer; transition: all 0.3s ease; font-weight: 600; box-shadow: 0 3px 8px rgba(0,0,0,0.15); } #search-btn:hover { background: #2980b9; transform: translateY(-2px); box-shadow: 0 5px 12px rgba(0,0,0,0.2); } .engine-selector { display: flex; justify-content: center; gap: 12px; margin-top: 12px; } .engine-btn { width: 40px; height: 40px; border-radius: 50%; border: 2px solid rgba(255, 255, 255, 0.3); background: rgba(255, 255, 255, 0.15); display: flex; justify-content: center; align-items: center; cursor: pointer; transition: all 0.25s ease; backdrop-filter: blur(4px); } .engine-btn:hover { transform: scale(1.1); border-color: white; } .engine-btn.active { border-color: white; background: rgba(255, 255, 255, 0.3); } .engine-icon { width: 20px; height: 20px; object-fit: contain; } .tabs-container { display: flex; justify-content: center; gap: 8px; margin-top: 18px; flex-wrap: wrap; } .tab-item { width: 44px; height: 44px; border-radius: 50%; background: rgba(255, 255, 255, 0.2); display: flex; justify-content: center; align-items: center; cursor: pointer; transition: all 0.2s ease; position: relative; overflow: hidden; opacity: 0; transform: scale(0.8); } .tab-item.appear { animation: fadeInScale 0.4s forwards; } @keyframes fadeInScale { to { opacity: 1; transform: scale(1); } } .tab-item:hover { transform: scale(1.15); background: rgba(255, 255, 255, 0.3); } .tab-icon { width: 24px; height: 24px; object-fit: contain; } .add-tab-btn { width: 44px; height: 44px; border-radius: 50%; background: rgba(52, 152, 219, 0.3); display: flex; justify-content: center; align-items: center; color: white; font-size: 24px; cursor: pointer; transition: all 0.2s ease; border: 2px dashed rgba(255, 255, 255, 0.5); } .add-tab-btn:hover { background: rgba(52, 152, 219, 0.5); transform: scale(1.15); } .context-menu { position: absolute; background: rgba(30, 40, 80, 0.95); backdrop-filter: blur(10px); border-radius: 10px; padding: 8px 0; box-shadow: 0 4px 12px rgba(0,0,0,0.3); z-index: 1000; min-width: 120px; display: none; } .context-menu-item { padding: 8px 16px; color: white; text-decoration: none; display: block; cursor: pointer; transition: background 0.2s; } .context-menu-item:hover { background: rgba(255, 255, 255, 0.15); } .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); display: flex; justify-content: center; align-items: center; z-index: 1000; opacity: 0; visibility: hidden; transition: all 0.3s ease; } .modal.show { opacity: 1; visibility: visible; } .modal-content { background: white; padding: 20px; border-radius: 16px; width: 90%; max-width: 380px; } .modal h3 { margin-bottom: 14px; color: #2c3e50; text-align: center; font-size: 18px; } .modal-input { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; margin-bottom: 14px; font-size: 15px; } .modal-buttons { display: flex; gap: 10px; } .modal-btn { flex: 1; padding: 8px; border: none; border-radius: 8px; font-size: 15px; cursor: pointer; } .modal-cancel { background: #ecf0f1; color: #2c3e50; } .modal-add { background: #3498db; color: white; } .top-right-hint { position: fixed; top: 20px; right: 20px; color: white; font-size: 15px; opacity: 0.9; text-align: center; z-index: 5; background: rgba(0,0,0,0.3); padding: 5px 10px; border-radius: 20px; backdrop-filter: blur(4px); } .test-badge { position: fixed; top: 20px; left: 20px; background: rgba(231, 76, 60, 0.9); color: white; padding: 6px 12px; border-radius: 20px; font-size: 14px; font-weight: bold; z-index: 100; box-shadow: 0 4px 8px rgba(0,0,0,0.2); } .widgets-drawer { position: fixed; top: 0; right: -320px; width: 300px; height: 100vh; background: rgba(20, 30, 70, 0.95); backdrop-filter: blur(12px); border-left: 1px solid rgba(255, 255, 255, 0.1); padding: 20px 15px; transition: right 0.35s cubic-bezier(0.3, 0, 0, 1); z-index: 90; overflow-y: auto; } .widgets-drawer.open { right: 0; } .drawer-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 1px solid rgba(255, 255, 255, 0.1); } .drawer-title { color: white; font-size: 20px; font-weight: 600; } .widgets-toggle { position: fixed; bottom: 20px; right: 20px; width: 24px; height: 24px; background: #ffcc00; border-radius: 50%; cursor: pointer; z-index: 100; box-shadow: 0 2px 6px rgba(0,0,0,0.2); } .widget-preview { background: rgba(255, 255, 255, 0.15); border-radius: 16px; padding: 16px; margin-bottom: 16px; cursor: pointer; transition: transform 0.2s; user-select: none; } .widget-preview:hover { transform: scale(1.02); background: rgba(255, 255, 255, 0.25); } .widget-preview h4 { color: white; margin-bottom: 12px; font-size: 16px; } .widgets-container { position: absolute; left: 20px; top: 120px; width: calc(100% - 40px); max-width: 440px; display: flex; flex-direction: column; gap: 16px; z-index: 80; } .widget-item { background: rgba(255, 255, 255, 0.2); border-radius: 16px; padding: 16px; backdrop-filter: blur(8px); border: 1px solid rgba(255, 255, 255, 0.15); box-shadow: 0 4px 12px rgba(0,0,0,0.15); position: relative; } .sticky-note { width: 100%; height: 100%; background: rgba(255, 255, 204, 0.9); border-radius: 12px; padding: 12px; font-family: inherit; font-size: 14px; color: #333; resize: none; border: 1px solid #ddd; outline: none; } .sticky-note:focus { border-color: #3498db; } .complete-btn { position: absolute; bottom: 12px; left: 12px; background: #2ecc71; color: white; border: none; padding: 6px 12px; border-radius: 20px; font-size: 12px; cursor: pointer; font-weight: bold; } .complete-btn:hover { background: #27ae60; } .calendar-widget { width: 100%; height: 100%; background: rgba(255, 255, 255, 0.9); border-radius: 12px; padding: 12px; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; } .calendar-date { font-size: 18px; font-weight: bold; color: #2c3e50; margin-bottom: 4px; } .calendar-lunar { font-size: 14px; color: #7f8c8d; margin-bottom: 4px; } .calendar-holiday { font-size: 12px; color: #e74c3c; font-weight: bold; } .quick-bg-widget { width: 100%; height: 100%; border-radius: 12px; overflow: hidden; position: relative; } .quick-bg-image { width: 100%; height: 100%; object-fit: cover; } .quick-bg-controls { position: absolute; bottom: 8px; left: 0; right: 0; display: flex; justify-content: space-between; padding: 0 8px; } .quick-bg-btn { background: rgba(0, 0, 0, 0.5); color: white; border: none; width: 30px; height: 30px; border-radius: 50%; font-size: 16px; cursor: pointer; display: flex; align-items: center; justify-content: center; } .quick-bg-btn:hover { background: rgba(0, 0, 0, 0.7); } @media (max-width: 600px) { .main-title { font-size: 30px; } .sub-title { font-size: 16px; } #time-display { font-size: 20px; } .search-form { flex-direction: column; } #search-btn { width: 100%; } .tab-item, .add-tab-btn { width: 40px; height: 40px; } .tab-icon { width: 22px; height: 22px; } .engine-btn { width: 36px; height: 36px; } .engine-icon { width: 18px; height: 18px; } .widgets-drawer { width: 280px; } .widgets-toggle { bottom: 16px; right: 16px; width: 20px; height: 20px; } } </style> </head> <body class="time-mode"> <div class="test-badge">测试版</div> <div class="top-right-hint">点击 Quickerch 开始键入世界</div> <div class="widgets-drawer" id="widgetsDrawer"> <div class="drawer-header"> <div class="drawer-title">小组件</div> </div> <div class="widget-preview" data-type="sticky"> <h4>便利贴</h4> <div style="display:flex;justify-content:center;"> <svg width="60" height="60" viewBox="0 0 100 100"> <rect x="10" y="10" width="80" height="80" rx="8" fill="#fff2cc" stroke="#d6b656" stroke-width="2"/> <line x1="20" y1="30" x2="80" y2="30" stroke="#d6b656" stroke-width="1"/> <line x1="20" y1="45" x2="80" y2="45" stroke="#d6b656" stroke-width="1"/> <line x1="20" y1="60" x2="80" y2="60" stroke="#d6b656" stroke-width="1"/> </svg> </div> </div> <div class="widget-preview" data-type="calendar"> <h4>小日历</h4> <div style="display:flex;justify-content:center;"> <svg width="60" height="60" viewBox="0 0 100 100"> <rect x="10" y="15" width="80" height="70" rx="5" fill="#ecf0f1" stroke="#bdc3c7" stroke-width="2"/> <rect x="15" y="20" width="70" height="10" fill="#3498db"/> <circle cx="25" cy="40" r="3" fill="#2ecc71"/> <circle cx="45" cy="40" r="3" fill="#2ecc71"/> <circle cx="65" cy="40" r="3" fill="#2ecc71"/> <circle cx="25" cy="60" r="3" fill="#2ecc71"/> <circle cx="45" cy="60" r="3" fill="#2ecc71"/> <circle cx="65" cy="60" r="3" fill="#e74c3c"/> </svg> </div> </div> <div class="widget-preview" data-type="quick-bg"> <h4>Quick背景</h4> <div style="display:flex;justify-content:center;"> <svg width="60" height="60" viewBox="0 0 100 100"> <rect x="10" y="10" width="80" height="80" rx="8" fill="#2ecc71" stroke="#27ae60" stroke-width="2"/> <text x="50" y="55" text-anchor="middle" fill="white" font-size="12" font-family="Arial">BG</text> </svg> </div> </div> </div> <div class="widgets-toggle" id="widgetsToggle"></div> <div class="container"> <h1 class="main-title" id="quickerchTitle"> <span class="quick-part">Quick</span><span class="erch-part">erch</span> <span class="beta-badge">Beta版</span> </h1> <h2 class="sub-title">轻起始页</h2> <div id="time-display"></div> </div> <div class="modal" id="addTabModal"> <div class="modal-content"> <h3>添加新标签页</h3> <input type="url" class="modal-input" id="tabUrlInput" placeholder="https://example.com" required> <div class="modal-buttons"> <button class="modal-btn modal-cancel" id="cancelBtn">取消</button> <button class="modal-btn modal-add" id="confirmBtn">添加</button> </div> </div> </div> <div class="modal" id="editTabModal"> <div class="modal-content"> <h3>编辑标签页</h3> <input type="url" class="modal-input" id="editTabUrlInput" placeholder="https://example.com" required> <div class="modal-buttons"> <button class="modal-btn modal-cancel" id="cancelEditBtn">取消</button> <button class="modal-btn modal-add" id="saveEditBtn">保存</button> </div> </div> </div> <script> const defaultTabs = [ { title: 'Bilibili', url: 'https://www.bilibili.com', icon: '/src/bilibili.png' }, { title: '爱奇艺', url: 'https://www.iqiyi.com', icon: '/src/iqiyi.png' }, { title: '优酷', url: 'https://www.youku.com', icon: '/src/youku.png' }, { title: 'CNDS', url: 'https://www.cndss.com', icon: '/src/cnds.png' } ]; function getFaviconUrl(url) { try { const urlObj = new URL(url); return `${urlObj.origin}/favicon.ico`; } catch (e) { return '/src/default-favicon.png'; } } function loadTabs() { const saved = localStorage.getItem('quickerchTabs'); if (saved) return JSON.parse(saved); saveTabs(defaultTabs); return defaultTabs; } function saveTabs(tabs) { localStorage.setItem('quickerchTabs', JSON.stringify(tabs)); } let currentEditIndex = -1; function showContextMenu(x, y, index) { let menu = document.getElementById('contextMenu'); if (!menu) { menu = document.createElement('div'); menu.id = 'contextMenu'; menu.className = 'context-menu'; menu.innerHTML = ` <div class="context-menu-item" id="editTab">编辑</div> <div class="context-menu-item" id="deleteTab">删除</div> `; document.body.appendChild(menu); } menu.style.left = x + 'px'; menu.style.top = y + 'px'; menu.style.display = 'block'; document.getElementById('editTab').onclick = () => { menu.style.display = 'none'; currentEditIndex = index; document.getElementById('editTabUrlInput').value = loadTabs()[index].url; document.getElementById('editTabModal').classList.add('show'); }; document.getElementById('deleteTab').onclick = () => { menu.style.display = 'none'; deleteTab(index); }; document.addEventListener('click', hideContextMenu, { once: true }); } function hideContextMenu() { const menu = document.getElementById('contextMenu'); if (menu) menu.style.display = 'none'; } function renderTabs(container) { container.innerHTML = ''; const tabs = loadTabs(); tabs.forEach((tab, index) => { const tabEl = document.createElement('div'); tabEl.className = 'tab-item'; tabEl.innerHTML = `<img src="${tab.icon || getFaviconUrl(tab.url)}" alt="" class="tab-icon" onerror="this.src='/src/default-favicon.png'">`; tabEl.addEventListener('click', () => { window.open(tab.url, '_blank'); }); tabEl.addEventListener('contextmenu', (e) => { e.preventDefault(); const rect = tabEl.getBoundingClientRect(); showContextMenu(e.clientX, e.clientY, index); }); let pressTimer; tabEl.addEventListener('touchstart', (e) => { pressTimer = setTimeout(() => { const rect = tabEl.getBoundingClientRect(); showContextMenu(rect.left, rect.bottom + 5, index); }, 2000); }); tabEl.addEventListener('touchend', () => { clearTimeout(pressTimer); }); tabEl.addEventListener('touchcancel', () => { clearTimeout(pressTimer); }); container.appendChild(tabEl); setTimeout(() => tabEl.classList.add('appear'), index * 100); }); const addBtn = document.createElement('div'); addBtn.className = 'add-tab-btn'; addBtn.textContent = '+'; addBtn.addEventListener('click', () => document.getElementById('addTabModal').classList.add('show')); container.appendChild(addBtn); setTimeout(() => addBtn.classList.add('appear'), tabs.length * 100); } function addTab(url) { if (!url) return; if (!url.startsWith('http://') && !url.startsWith('https://')) { url = 'https://' + url; } try { const urlObj = new URL(url); const title = urlObj.hostname.replace('www.', ''); const newTab = { title, url, icon: getFaviconUrl(url) }; const tabs = loadTabs(); tabs.push(newTab); saveTabs(tabs); const container = document.querySelector('.tabs-container'); if (container) renderTabs(container); } catch (e) { alert('无效的 URL'); } } function deleteTab(index) { const tabs = loadTabs(); tabs.splice(index, 1); saveTabs(tabs); const container = document.querySelector('.tabs-container'); if (container) renderTabs(container); } function saveEditedTab(url) { if (!url) return; if (!url.startsWith('http://') && !url.startsWith('https://')) { url = 'https://' + url; } try { const urlObj = new URL(url); const title = urlObj.hostname.replace('www.', ''); const tabs = loadTabs(); tabs[currentEditIndex] = { title, url, icon: getFaviconUrl(url) }; saveTabs(tabs); const container = document.querySelector('.tabs-container'); if (container) renderTabs(container); currentEditIndex = -1; } catch (e) { alert('无效的 URL'); } } const backgrounds = ['/src/bg1.jpg','/src/bg2.jpg','/src/bg3.jpg','/src/bg4.jpg','/src/bg5.jpg']; const quickBgImages = ['/src/bgg2.jpg', '/src/bgg3.jpg', '/src/bgg4.jpg']; function getRandomBackground() { return backgrounds[Math.floor(Math.random() * backgrounds.length)]; } function updateTime() { const now = new Date(); const beijingTime = new Date(now.toLocaleString("en-US", { timeZone: "Asia/Shanghai" })); document.getElementById('time-display').textContent = beijingTime.toLocaleTimeString('zh-CN', { hour12: false }); } function getLunarDate(date) { const solarYear = date.getFullYear(); const solarMonth = date.getMonth() + 1; const solarDay = date.getDate(); const lunarMap = { '2026-2-17': '正月二十', '2026-2-16': '正月十九', '2026-2-15': '正月十八', '2026-2-14': '正月十七', '2026-2-13': '正月十六', '2026-2-12': '正月十五', '2026-2-11': '正月十四', '2026-2-10': '正月十三', '2026-2-9': '正月十二', '2026-2-8': '正月十一', '2026-2-7': '正月初十', '2026-2-6': '正月初九', '2026-2-5': '正月初八', '2026-2-4': '正月初七', '2026-2-3': '正月初六', '2026-2-2': '正月初五', '2026-2-1': '正月初四', '2026-1-31': '正月初三', '2026-1-30': '正月初二', '2026-1-29': '正月初一' }; const key = `${solarYear}-${solarMonth}-${solarDay}`; return lunarMap[key] || '农历日期'; } function getHoliday(date) { const month = date.getMonth() + 1; const day = date.getDate(); const holidays = { '1-1': '元旦', '2-14': '情人节', '3-8': '妇女节', '5-1': '劳动节', '6-1': '儿童节', '10-1': '国庆节' }; const key = `${month}-${day}`; return holidays[key] || ''; } let isSearchMode = false; let searchBox = null; let widgetsContainer = null; let hasCalendar = false; let hasQuickBgWidget = false; let currentBgIndex = 0; function createWidgetsContainer() { if (widgetsContainer) return; widgetsContainer = document.createElement('div'); widgetsContainer.className = 'widgets-container'; document.body.appendChild(widgetsContainer); loadWidgets(); } function removeWidgetsContainer() { if (widgetsContainer) { widgetsContainer.remove(); widgetsContainer = null; hasCalendar = false; hasQuickBgWidget = false; } } function loadWidgets() { const widgets = JSON.parse(localStorage.getItem('widgets') || '[]'); widgetsContainer.innerHTML = ''; hasCalendar = false; hasQuickBgWidget = false; widgets.forEach(widget => { if (widget.type === 'sticky') { createStickyNote(widget.content, widget.id, widget.width || 1, widget.height || 1); } else if (widget.type === 'calendar') { createCalendarWidget(widget.id, widget.width || 1, widget.height || 1); hasCalendar = true; } else if (widget.type === 'quick-bg') { createQuickBgWidget(widget.id, widget.width || 0.1, widget.height || 0.1); hasQuickBgWidget = true; currentBgIndex = widget.imageIndex || 0; } }); } function saveWidgets() { const widgets = []; const widgetItems = widgetsContainer.querySelectorAll('.widget-item'); widgetItems.forEach(item => { const style = window.getComputedStyle(item); const width = parseFloat(style.width) / widgetsContainer.offsetWidth; const height = parseFloat(style.height) / item.parentElement.offsetHeight; if (item.dataset.type === 'sticky') { const textarea = item.querySelector('.sticky-note'); widgets.push({ type: 'sticky', id: item.dataset.id, content: textarea.value, width: Math.min(2, Math.max(0.5, width)), height: Math.min(2, Math.max(0.5, height)) }); } else if (item.dataset.type === 'calendar') { widgets.push({ type: 'calendar', id: item.dataset.id, width: Math.min(2, Math.max(0.5, width)), height: Math.min(2, Math.max(0.5, height)) }); } else if (item.dataset.type === 'quick-bg') { widgets.push({ type: 'quick-bg', id: item.dataset.id, width: Math.min(2, Math.max(0.1, width)), height: Math.min(2, Math.max(0.1, height)), imageIndex: currentBgIndex }); } }); localStorage.setItem('widgets', JSON.stringify(widgets)); } function createStickyNote(content = '', id = null, width = 1, height = 1) { const widget = document.createElement('div'); widget.className = 'widget-item'; widget.dataset.id = id !== null ? id : Date.now(); widget.dataset.type = 'sticky'; widget.style.width = `${Math.min(200, Math.max(50, width * 100))}%`; widget.style.height = `${Math.min(200, Math.max(50, height * 100))}%`; const textarea = document.createElement('textarea'); textarea.className = 'sticky-note'; textarea.placeholder = '输入你的笔记...'; textarea.value = content; const completeBtn = document.createElement('button'); completeBtn.className = 'complete-btn'; completeBtn.textContent = '完成'; widget.appendChild(textarea); widget.appendChild(completeBtn); widgetsContainer.appendChild(widget); textarea.addEventListener('input', saveWidgets); completeBtn.addEventListener('click', () => { widget.remove(); saveWidgets(); }); setupLongPress(widget); } function createCalendarWidget(id = null, width = 1, height = 1) { if (hasCalendar) return; hasCalendar = true; const widget = document.createElement('div'); widget.className = 'widget-item'; widget.dataset.id = id !== null ? id : Date.now(); widget.dataset.type = 'calendar'; widget.style.width = `${Math.min(200, Math.max(50, width * 100))}%`; widget.style.height = `${Math.min(200, Math.max(50, height * 100))}%`; const now = new Date(); const beijingTime = new Date(now.toLocaleString("en-US", { timeZone: "Asia/Shanghai" })); const year = beijingTime.getFullYear(); const month = String(beijingTime.getMonth() + 1).padStart(2, '0'); const day = String(beijingTime.getDate()).padStart(2, '0'); const lunar = getLunarDate(beijingTime); const holiday = getHoliday(beijingTime); widget.innerHTML = ` <div class="calendar-widget"> <div class="calendar-date">${year}-${month}-${day}</div> <div class="calendar-lunar">${lunar}</div> ${holiday ? `<div class="calendar-holiday">${holiday}</div>` : ''} </div> `; widgetsContainer.appendChild(widget); setupLongPress(widget); } function createQuickBgWidget(id = null, width = 0.1, height = 0.1) { if (hasQuickBgWidget) return; hasQuickBgWidget = true; const widget = document.createElement('div'); widget.className = 'widget-item'; widget.dataset.id = id !== null ? id : Date.now(); widget.dataset.type = 'quick-bg'; widget.style.width = `${Math.min(200, Math.max(10, width * 100))}%`; widget.style.height = `${Math.min(200, Math.max(10, height * 100))}%`; const img = document.createElement('img'); img.className = 'quick-bg-image'; img.src = quickBgImages[currentBgIndex]; img.alt = 'Quick背景'; img.onerror = () => { img.style.backgroundColor = '#2ecc71'; img.style.display = 'block'; }; const controls = document.createElement('div'); controls.className = 'quick-bg-controls'; const prevBtn = document.createElement('button'); prevBtn.className = 'quick-bg-btn'; prevBtn.textContent = '<'; prevBtn.onclick = () => { currentBgIndex = (currentBgIndex - 1 + quickBgImages.length) % quickBgImages.length; img.src = quickBgImages[currentBgIndex]; saveWidgets(); }; const nextBtn = document.createElement('button'); nextBtn.className = 'quick-bg-btn'; nextBtn.textContent = '>'; nextBtn.onclick = () => { currentBgIndex = (currentBgIndex + 1) % quickBgImages.length; img.src = quickBgImages[currentBgIndex]; saveWidgets(); }; controls.appendChild(prevBtn); controls.appendChild(nextBtn); widget.appendChild(img); widget.appendChild(controls); widgetsContainer.appendChild(widget); setupLongPress(widget); } function setupLongPress(element) { let longPressTimer; element.addEventListener('contextmenu', (e) => { e.preventDefault(); showWidgetMenu(e.clientX, e.clientY, element); }); element.addEventListener('touchstart', (e) => { longPressTimer = setTimeout(() => { const rect = element.getBoundingClientRect(); showWidgetMenu(rect.left, rect.bottom + 5, element); }, 1000); }); element.addEventListener('touchend', () => { clearTimeout(longPressTimer); }); element.addEventListener('touchcancel', () => { clearTimeout(longPressTimer); }); } function showWidgetMenu(x, y, widget) { let menu = document.getElementById('widgetContextMenu'); if (!menu) { menu = document.createElement('div'); menu.id = 'widgetContextMenu'; menu.className = 'context-menu'; menu.innerHTML = ` <div class="context-menu-item" style="color:#e74c3c;" id="deleteWidget">移除</div> <div class="context-menu-item" id="resizeWidget">自定义大小</div> `; document.body.appendChild(menu); } else { menu.innerHTML = ` <div class="context-menu-item" style="color:#e74c3c;" id="deleteWidget">移除</div> <div class="context-menu-item" id="resizeWidget">自定义大小</div> `; } if (widget.dataset.type === 'quick-bg') { menu.innerHTML += ` <div class="context-menu-item" id="setAsBackground">设为背景</div> <div class="context-menu-item" id="useSolidBackground">使用纯色背景</div> `; } menu.style.left = x + 'px'; menu.style.top = y + 'px'; menu.style.display = 'block'; document.getElementById('deleteWidget').onclick = () => { if (widget.dataset.type === 'calendar') { hasCalendar = false; } else if (widget.dataset.type === 'quick-bg') { hasQuickBgWidget = false; } menu.style.display = 'none'; widget.remove(); saveWidgets(); }; document.getElementById('resizeWidget').onclick = () => { menu.style.display = 'none'; showResizeModal(widget); }; if (widget.dataset.type === 'quick-bg') { document.getElementById('setAsBackground').onclick = () => { menu.style.display = 'none'; const bgUrl = quickBgImages[currentBgIndex]; document.body.style.backgroundImage = `url('${bgUrl}')`; document.body.style.backgroundSize = 'cover'; document.body.style.backgroundPosition = 'center'; document.body.style.backgroundRepeat = 'no-repeat'; localStorage.setItem('customBackground', bgUrl); localStorage.setItem('isCustomBackground', 'true'); }; document.getElementById('useSolidBackground').onclick = () => { menu.style.display = 'none'; document.body.style.backgroundImage = ''; localStorage.setItem('isCustomBackground', 'false'); }; } document.addEventListener('click', () => { menu.style.display = 'none'; }, { once: true }); } function showResizeModal(widget) { const modal = document.createElement('div'); modal.className = 'modal show'; modal.innerHTML = ` <div class="modal-content"> <h3>调整大小</h3> <div style="margin-bottom:10px;"> <label>宽度倍率: <input type="number" id="widthScale" min="0.1" max="2" step="0.1" value="0.1"></label> </div> <div style="margin-bottom:14px;"> <label>高度倍率: <input type="number" id="heightScale" min="0.1" max="2" step="0.1" value="0.1"></label> </div> <div class="modal-buttons"> <button class="modal-btn modal-cancel" id="cancelResize">取消</button> <button class="modal-btn modal-add" id="applyResize">应用</button> </div> </div> `; document.body.appendChild(modal); const currentWidth = parseFloat(widget.style.width) / 100 || 0.1; const currentHeight = parseFloat(widget.style.height) / 100 || 0.1; document.getElementById('widthScale').value = currentWidth; document.getElementById('heightScale').value = currentHeight; document.getElementById('cancelResize').onclick = () => { modal.remove(); }; document.getElementById('applyResize').onclick = () => { const widthScale = parseFloat(document.getElementById('widthScale').value) || 0.1; const heightScale = parseFloat(document.getElementById('heightScale').value) || 0.1; widget.style.width = `${Math.min(200, Math.max(10, widthScale * 100))}%`; widget.style.height = `${Math.min(200, Math.max(10, heightScale * 100))}%`; saveWidgets(); modal.remove(); }; } function enterSearchMode() { if (isSearchMode) return; isSearchMode = true; document.getElementById('quickerchTitle').classList.add('pressed'); const body = document.body; const timeDisplay = document.getElementById('time-display'); const container = document.querySelector('.container'); setTimeout(() => { body.classList.remove('time-mode'); body.classList.add('search-mode'); const isCustom = localStorage.getItem('isCustomBackground') === 'true'; const customBg = localStorage.getItem('customBackground'); if (isCustom && customBg) { body.style.backgroundImage = `url('${customBg}')`; body.style.backgroundSize = 'cover'; body.style.backgroundPosition = 'center'; body.style.backgroundRepeat = 'no-repeat'; } else { body.style.backgroundImage = ''; } timeDisplay.style.opacity = '0'; searchBox = document.createElement('div'); searchBox.className = 'search-box'; searchBox.innerHTML = ` <form id="search-form" target="_blank"> <div class="search-form"> <input type="text" id="search-input" placeholder="输入关键词搜索..." autocomplete="off" autofocus> <button type="submit" id="search-btn">搜索</button> </div> <div class="engine-selector"> <div class="engine-btn active" data-engine="bing"> <img src="/src/bingpic.png" alt="Bing" class="engine-icon"> </div> <div class="engine-btn" data-engine="baidu"> <img src="/src/baidu.png" alt="百度" class="engine-icon"> </div> <div class="engine-btn" data-engine="yandex"> <img src="/src/yandex.png" alt="Yandex" class="engine-icon"> </div> </div> </form> `; container.appendChild(searchBox); const tabsContainer = document.createElement('div'); tabsContainer.className = 'tabs-container'; container.appendChild(tabsContainer); renderTabs(tabsContainer); createWidgetsContainer(); document.getElementById('widgetsToggle').style.display = 'block'; setTimeout(() => { searchBox.classList.add('visible'); }, 100); bindSearchEvents(); }, 300); } function exitSearchMode() { if (!isSearchMode) return; isSearchMode = false; if (searchBox) { searchBox.remove(); searchBox = null; } const tabsContainer = document.querySelector('.tabs-container'); if (tabsContainer) { tabsContainer.remove(); } removeWidgetsContainer(); document.getElementById('widgetsToggle').style.display = 'none'; document.getElementById('widgetsDrawer').classList.remove('open'); const body = document.body; const timeDisplay = document.getElementById('time-display'); body.classList.remove('search-mode'); body.classList.add('time-mode'); const bg = getRandomBackground(); body.style.backgroundImage = `linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.7)), url('${bg}')`; timeDisplay.style.opacity = '1'; const title = document.getElementById('quickerchTitle'); title.classList.remove('pressed'); title.classList.add('released'); setTimeout(() => { title.classList.remove('released'); }, 600); } function bindSearchEvents() { const form = document.getElementById('search-form'); const input = document.getElementById('search-input'); const engineButtons = document.querySelectorAll('.engine-btn'); let currentEngine = 'bing'; const engines = { bing: 'https://www.bing.com/search?q=', baidu: 'https://www.baidu.com/s?wd=', yandex: 'https://yandex.com/search/?text=' }; engineButtons.forEach(btn => { btn.addEventListener('click', function () { engineButtons.forEach(b => b.classList.remove('active')); this.classList.add('active'); currentEngine = this.dataset.engine; }); }); form.addEventListener('submit', function (e) { e.preventDefault(); const query = encodeURIComponent(input.value.trim()); if (query) { window.open(engines[currentEngine] + query, '_blank'); } }); } document.addEventListener('DOMContentLoaded', function () { const bg = getRandomBackground(); document.body.style.backgroundImage = `linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.7)), url('${bg}')`; updateTime(); setInterval(updateTime, 1000); document.getElementById('widgetsToggle').style.display = 'none'; document.getElementById('quickerchTitle').addEventListener('click', function () { if (isSearchMode) { exitSearchMode(); } else { enterSearchMode(); } }); document.getElementById('widgetsToggle').addEventListener('click', function () { document.getElementById('widgetsDrawer').classList.toggle('open'); }); const widgetPreviews = document.querySelectorAll('.widget-preview'); widgetPreviews.forEach(preview => { preview.addEventListener('click', function () { if (isSearchMode && widgetsContainer) { const type = this.dataset.type; if (type === 'sticky') { createStickyNote(); } else if (type === 'calendar' && !hasCalendar) { createCalendarWidget(); } else if (type === 'quick-bg' && !hasQuickBgWidget) { createQuickBgWidget(); } document.getElementById('widgetsDrawer').classList.remove('open'); } }); }); document.getElementById('confirmBtn').addEventListener('click', function () { const url = document.getElementById('tabUrlInput').value.trim(); if (url) { addTab(url); document.getElementById('tabUrlInput').value = ''; document.getElementById('addTabModal').classList.remove('show'); } }); document.getElementById('cancelBtn').addEventListener('click', () => document.getElementById('addTabModal').classList.remove('show') ); document.getElementById('saveEditBtn').addEventListener('click', function () { const url = document.getElementById('editTabUrlInput').value.trim(); if (url) { saveEditedTab(url); document.getElementById('editTabUrlInput').value = ''; document.getElementById('editTabModal').classList.remove('show'); } }); document.getElementById('cancelEditBtn').addEventListener('click', () => document.getElementById('editTabModal').classList.remove('show') ); document.getElementById('addTabModal').addEventListener('click', function (e) { if (e.target === this) this.classList.remove('show'); }); document.getElementById('editTabModal').addEventListener('click', function (e) { if (e.target === this) this.classList.remove('show'); }); }); </script> </body> </html>
